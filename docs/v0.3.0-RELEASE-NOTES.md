# Noony Core v0.3.0 Release Notes

**Release Date:** November 5, 2025
**Status:** âœ… All features implemented and tested
**Test Coverage:** 311 tests passing (100% of test suite)

---

## ğŸ‰ Overview

Version 0.3.0 is a significant feature release that brings major developer experience improvements to the Noony Core framework. All changes are 100% backward compatible, allowing gradual adoption without breaking existing code.

---

## âœ¨ New Features

### 1. Enhanced Type Safety

#### Dual Generic Context
```typescript
// Before: Limited type safety
Context<CreateUserRequest>

// After: Full type safety for body AND user
Context<CreateUserRequest, AuthenticatedUser>
```

**Benefits:**
- No more `context.user as AuthenticatedUser` casts
- Full autocomplete for user properties
- Compile-time type checking for both request body and user

#### Fixed Container Type
```typescript
// Fixed: container is now properly typed as ContainerInstance
export interface Context<TBody, TUser> {
  container: ContainerInstance;  // âœ… No more casting needed
  user?: TUser;                   // âœ… Type-safe user access
}
```

### 2. New Error Classes

Six new HTTP error classes for standardized error handling:

```typescript
import {
  UnauthorizedError,    // 401 - Authentication required
  ForbiddenError,       // 403 - Insufficient permissions
  NotFoundError,        // 404 - Resource not found
  ConflictError,        // 409 - Resource conflicts
  InternalServerError,  // 500 - With error cause chaining
  ServiceError,         // Service layer errors with codes
} from '@noony-serverless/core';
```

**Usage Example:**
```typescript
const user = await userService.getUser(userId);
if (!user) {
  throw new NotFoundError('User not found');
}

if (!canAccess(user, resource)) {
  throw new ForbiddenError('Access denied');
}
```

### 3. Query Parameter Utilities

Type-safe query parameter helpers:

```typescript
import { asString, asStringArray, asNumber, asBoolean } from '@noony-serverless/core';

const options = {
  search: asString(query.search),      // string | undefined
  page: asNumber(query.page) || 1,     // number with default
  limit: asNumber(query.limit) || 10,  // number with default
  active: asBoolean(query.active),     // boolean | undefined
  tags: asStringArray(query.tags),     // string[] | undefined
};
```

**Benefits:**
- No more manual array checking
- Consistent parsing across all controllers
- Handles edge cases (empty strings, undefined, arrays)

### 4. Container Helper

Type-safe service resolution:

```typescript
import { getService } from '@noony-serverless/core';

// Before: Manual casting
const userService = (context.container as ContainerInstance).get(UserService);

// After: Type-safe helper
const userService = getService(context, UserService);
```

**Benefits:**
- Eliminates boilerplate
- Full type safety and autocomplete
- Clear error messages if container not initialized

### 5. Base Authenticated User Interface

```typescript
import { BaseAuthenticatedUser } from '@noony-serverless/core';

interface AuthenticatedUser extends BaseAuthenticatedUser {
  role: 'admin' | 'user';
  permissions: string[];
  tenantId: string;
}

// Full type safety throughout your app
async function handler(context: Context<RequestType, AuthenticatedUser>) {
  const user = context.user; // Type: AuthenticatedUser | undefined
  if (user?.role === 'admin') {
    // Full autocomplete support
  }
}
```

---

## ğŸ”§ Bug Fixes

### Fixed Query Parameter Edge Cases

**Issue:** Empty strings were incorrectly treated as `undefined`

```typescript
// Before (incorrect)
asStringArray('') â†’ undefined
asBoolean('') â†’ undefined

// After (correct)
asStringArray('') â†’ ['']
asBoolean('') â†’ false
```

### Fixed Container Pool Type

**Issue:** ContainerPool was using wrong type (`Container` instead of `ContainerInstance`)

```typescript
// Fixed in src/core/containerPool.ts
class ContainerPool {
  private availableContainers: ContainerInstance[]; // âœ… Correct type
}
```

### Resolved Zod v4 Compatibility

**Issue:** Zod v4 changed API from `error.errors` to `error.issues`

```typescript
// All middlewares updated to use Zod v4 API
throw new ValidationError('Validation error', error.issues);
```

---

## ğŸ“ New File Structure

```
src/
â”œâ”€â”€ utils/                         # âœ… NEW in v0.3.0
â”‚   â”œâ”€â”€ query-param.utils.ts      # Query parameter helpers
â”‚   â”œâ”€â”€ query-param.utils.test.ts # 100% test coverage
â”‚   â”œâ”€â”€ container.utils.ts        # Container helper
â”‚   â”œâ”€â”€ container.utils.test.ts   # 100% test coverage
â”‚   â””â”€â”€ index.ts                  # Utility exports
```

---

## ğŸ“Š Test Coverage

- âœ… **311 tests passing** (100% of test suite)
- âœ… **25 test suites passing**
- âœ… **0 test failures**
- âœ… **New utilities: 100% test coverage**

---

## ğŸ”„ Migration Guide

### Before (v0.2.x)

```typescript
import type { Context } from '@noony-serverless/core';
import { AuthenticatedUser } from '@auth';

export async function createUser(context: Context) {
  // âŒ Manual casting everywhere
  const userService = (context.container as any).get(UserService);
  const user = context.user as AuthenticatedUser;

  // âŒ Creating errors with any
  const error: any = new Error('User not found');
  error.statusCode = 404;
  throw error;

  // âŒ Manual query param handling
  const page = Array.isArray(context.req.query.page)
    ? parseInt(context.req.query.page[0], 10)
    : parseInt(context.req.query.page as string, 10);
}
```

### After (v0.3.0)

```typescript
import type { Context, BaseAuthenticatedUser } from '@noony-serverless/core';
import { getService, asNumber, NotFoundError } from '@noony-serverless/core';

interface AuthenticatedUser extends BaseAuthenticatedUser {
  role: string;
  tenantId: string;
}

export async function createUser(
  context: Context<CreateUserRequest, AuthenticatedUser>
) {
  // âœ… Type-safe service resolution
  const userService = getService(context, UserService);

  // âœ… Type-safe user access (no cast)
  const user = context.user;

  // âœ… Standard error class
  throw new NotFoundError('User not found');

  // âœ… Clean query param handling
  const page = asNumber(context.req.query.page) || 1;
}
```

---

## ğŸ¯ Benefits Summary

### Developer Experience
- âœ… **Less boilerplate** - No more manual casts and error creation
- âœ… **Better autocomplete** - TypeScript knows exact types
- âœ… **Fewer bugs** - Type safety catches errors at compile time
- âœ… **Cleaner code** - Standard utilities reduce repetition

### Code Quality
- âœ… **Consistency** - All projects use same patterns
- âœ… **Maintainability** - Centralized utilities easier to update
- âœ… **Testability** - Standard error classes easier to test
- âœ… **Documentation** - Types serve as inline documentation

---

## ğŸ”„ Backward Compatibility

All changes are **100% backward compatible**:

1. âœ… Container type fix - Only improves existing type safety
2. âœ… Error classes - New exports, don't break existing code
3. âœ… Query helpers - Optional utilities, existing code unchanged
4. âœ… getService helper - Optional utility, existing code unchanged
5. âœ… User generic - Defaults to `unknown`, existing code unchanged

**Projects can adopt v0.3.0 immediately with zero breaking changes.**

---

## ğŸ“¦ Build Artifacts

All new features are available in the compiled output:

```
build/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ container.utils.js
â”‚   â”œâ”€â”€ container.utils.d.ts      # Full TypeScript definitions
â”‚   â”œâ”€â”€ query-param.utils.js
â”‚   â””â”€â”€ query-param.utils.d.ts    # Full TypeScript definitions
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ core.d.ts                 # Updated with dual generics
â”‚   â””â”€â”€ errors.d.ts               # All new error classes
â””â”€â”€ index.d.ts                    # Updated exports
```

---

## ğŸš€ What's Next

### Ready for Publishing
- âœ… All features implemented
- âœ… All tests passing
- âœ… Documentation updated
- âœ… Build successful
- ğŸ“¦ Ready for npm publish

### Future Enhancements (v0.4.0+)
- Response helper functions (`ok()`, `created()`, `noContent()`)
- Enhanced validation helpers with Zod integration
- Additional query parameter utilities
- Performance monitoring improvements

---

## ğŸ“š Documentation

Updated documentation available:
- âœ… [CLAUDE.md](../CLAUDE.md) - Comprehensive framework guide
- âœ… [NOONY_CORE_IMPROVEMENTS.md](./NOONY_CORE_IMPROVEMENTS.md) - Implementation details
- âœ… Examples with full type safety demonstrations

---

## ğŸ™ Acknowledgments

This release incorporates patterns and utilities developed and tested in production by the convivencialdia-api team. Special thanks for the real-world feedback that shaped these improvements.

---

## ğŸ“ Support

For questions, issues, or feedback:
- Create an issue in the Noony repository
- Contact the Noony maintainers
- Check the updated documentation

---

**Noony Core v0.3.0** - Better types, better code, better developer experience! ğŸ‰
